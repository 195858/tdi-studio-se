<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>tPartitioner</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="bk-tdi-components-rg-en..html" title="Talend Components"><link rel="up" href="ch-orchestration.html" title="Chapter&nbsp;18.&nbsp;Orchestration components"><link rel="prev" href="tParallelize.html" title="tParallelize"><link rel="next" href="tPostjob.html" title="tPostjob"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">tPartitioner</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="tParallelize.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;18.&nbsp;Orchestration components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="tPostjob.html">Next</a></td></tr></table><hr></div><div lang="EN" class="section" title="tPartitioner"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tPartitioner"></a>tPartitioner</h2></div></div></div><div class="mediaobject"><img src="../images/tpartitioner_icon32_white.png"></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>This component will be available in the <span class="emphasis"><strong>Palette</strong></span> of
			the <span class="emphasis"><strong>Integration</strong></span> perspective of your studio on the
			condition that you have subscribed to one of the <span class="emphasis"><em>Talend Platform</em></span>
			solutions or Big Data solutions. </p></div><p>The parallelization components work closely with each other to accomplish parallel
		execution on given processes. The <span class="emphasis"><strong>tPartitioner</strong></span> component
		dispatches the input records into a specific number of threads; the <span class="emphasis"><strong>tCollector</strong></span> component sends these threads to its following components for
		parallel execution; the <span class="emphasis"><strong>tDepartitioner</strong></span> component regroups
		the outputs of the processed parallel threads; the <span class="emphasis"><strong>tRecollector</strong></span> component captures the output of a given <span class="emphasis"><strong>tDepartitioner</strong></span> component and sends the captured data to the next
		component.</p><div class="section" title="tPartitioner Properties"><div class="titlepage"><div><div><h3 class="title"><a name="d0e333338"></a>tPartitioner Properties</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Component family</strong></span>
							</p>
						</td><td valign="top">
							<p>Orchestration</p>
						</td><td valign="top">&nbsp;</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Function</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>This component splits the input records into a given number of
								threads which <span class="emphasis"><strong>tCollector</strong></span> sends for
								parallel execution.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Purpose</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>This component partitions the input data before <span class="emphasis"><strong>tCollector</strong></span> can transfer them to the
								parallel execution processes.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Basic settings</strong></span>
							</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>Schema</em></span> and <span class="emphasis"><em>Edit
								Schema</em></span></p>
						</td><td valign="top">
							<p>A schema is a row description, i.e., it defines the number of fields to be processed and
		passed on to the next component. <span>The schema is either
				<span class="emphasis"><strong>Built-in</strong></span> or stored remotely in the <span class="emphasis"><strong>Repository</strong></span></span>.</p>
							<p>Click <span class="emphasis"><strong>Edit Schema</strong></span> to make changes to the schema. <span>Note that if you make changes, the schema automatically becomes
			built-in.</span></p>
							<p> Click <span class="emphasis"><strong>Sync columns</strong></span> to retrieve
		the schema from the previous component connected in the Job.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td>
							<p>&nbsp;<span class="emphasis"><em>Number of Child Threads</em></span></p>
						</td><td valign="top">
							<p>Enter the number of threads you want to split the input records up
								into.</p>
							<p>We recommend that this number be N-1 where N is the total number
								of CPUs or cores on the machine processing the data.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>Buffer Size</em></span>
							</p>
						</td><td valign="top">
							<p>Enter the number of rows to be processed before the memory is	freed.</p>
							<p>This is the number of rows to cache for each of the threads
								generated.</p>
						</td></tr><tr><td>&nbsp;</td><td valign="top">
							<p>
								<span class="emphasis"><em>Use a key hash for partitions</em></span>
							</p>
						</td><td valign="top">
							<p>Select this check box to use the hash mode to dispatch the input
								records into threads. </p>
							<p>Once selecting it, the <span class="emphasis"><strong>Key
									Columns</strong></span> table appears, in which you set the column(s)
								you want to apply the hash mode on. In the hash mode, the records
								meeting the same criteria are dispatched into the same threads. </p>
							<p>If you leave this check box clear, the dispatch mode is
								Round-robin, meaning records are dispatched one-by-one to each
								thread, in a circular fashion, until the last record is dispatched.
								Be aware that this mode cannot guarantee that records meeting the
								same criteria go into the same threads.</p>
						</td></tr><tr><td>
							<span class="emphasis"><strong>Advanced settings</strong></span>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>tStatCatcher Statistics</em></span>
							</p>
						</td><td valign="top">
							<p>Select this check box to collect the log data at the component
								level.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Usage</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>This component should be put after the input component(s) and
								before <span class="emphasis"><strong>tCollector</strong></span>.</p>
							<p>This component uses and can only use the <span class="emphasis"><strong>Trigger &gt; Start</strong></span> link to connect to <span class="emphasis"><strong>tCollector</strong></span>.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Global Variables</strong></span>
							</p>
						</td><td valign="top">&nbsp;</td><td valign="top">
							<p><span class="emphasis"><strong>NB_LINE</strong></span>: indicates the number of lines processed. This is
		available as an <span class="emphasis"><strong>After</strong></span> variable</p>
							<p> </p>
							<p> For further information regarding global variables, see <span class="emphasis"><em>Talend Data Integration Studio</em></span>
		<span class="emphasis"><em>User Guide</em></span>.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Connections</strong></span>
							</p>
						</td><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>Outgoing links (from this component to the next):</p>
							<p>
								<span class="emphasis"><strong>Trigger</strong></span>: Start.</p>
							<p> </p>
							<p> Incoming links (from the preceding component to this
								component):</p>
							<p>
								<span class="emphasis"><strong>Row</strong></span>: Main.</p>
							<p> </p>
							<p> For further information regarding connections, see <span class="emphasis"><em>Talend Data Integration Studio</em></span> User Guide.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Limitation</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Scenario: sorting the customer data of large size in parallel"><div class="titlepage"><div><div><h3 class="title"><a name="ychen-20121126-orchestration-tpartitioner"></a>Scenario: sorting the customer data of large size in parallel</h3></div></div></div><p>The Job in this scenario puts in order 20 million customer records by running
			parallellized executions.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization11.png" align="middle"></div><div class="section" title="Linking the components"><div class="titlepage"><div><div><h4 class="title"><a name="d0e333654"></a>Linking the components</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>In the <span class="emphasis"><strong>Integration</strong></span> perspective of your
						studio, create an empty Job from the<span class="emphasis"><strong> Job
							Designs</strong></span> node in the <span class="emphasis"><strong>Repository</strong></span> tree view.</p><p>For further information about how to create a Job, see the user guide of
						your integration studio.</p></li><li class="step" title="Step 2"><p>Drop the following components onto the workspace: <span class="emphasis"><strong>tFileInputDelimited</strong></span>, <span class="emphasis"><strong>tPartitioner</strong></span>, <span class="emphasis"><strong>tCollector</strong></span>,
							<span class="emphasis"><strong>tSortRow</strong></span>, <span class="emphasis"><strong>tDepartitioner</strong></span>, <span class="emphasis"><strong>tRecollector</strong></span>, <span class="emphasis"><strong>tFileOutputDelimited</strong></span>.</p><p>The <span class="emphasis"><strong>tFileInputDelimited</strong></span> component
						(labeled <span class="emphasis"><em>test file</em></span> in this example) reads
						the 20 million customer records from a <span class="emphasis"><em>.txt</em></span> file generated by <span class="emphasis"><strong>tRowGenerator</strong></span>.</p><p>For further information about the <span class="emphasis"><strong>tRowGenerator</strong></span> component, see <a class="xref" href="tRowGenerator.html" title="tRowGenerator">the section called &#8220;tRowGenerator&#8221;</a></p><p>For further information about how to label a component, see the user guide
						of your integration studio.</p></li><li class="step" title="Step 3"><p>Connect <span class="emphasis"><strong>tPartitioner</strong></span> to <span class="emphasis"><strong>tCollector</strong></span> and to <span class="emphasis"><strong>tRecollector</strong></span>, using the <span class="emphasis"><strong>Trigger &gt;
							Starts</strong></span> link.</p></li><li class="step" title="Step 4"><p>Connect the other components using the <span class="emphasis"><strong>Row &gt;
							Main</strong></span> link.</p></li></ol></div></div><div class="section" title="Splitting the input data flow"><div class="titlepage"><div><div><h4 class="title"><a name="d0e333739"></a>Splitting the input data flow</h4></div></div></div><div class="procedure" title="Procedure&nbsp;18.1.&nbsp;Configuring the input flow"><a name="d0e333742"></a><p class="title"><b>Procedure&nbsp;18.1.&nbsp;Configuring the input flow</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click <span class="emphasis"><strong>tFileInputDelimited</strong></span> to open
						its <span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization12.png" align="middle"></div></li><li class="step" title="Step 2"><p>In the <span class="emphasis"><strong>File name/Stream</strong></span> field, browse to,
						or enter the path to the file storing the customer records to be
						read.</p></li><li class="step" title="Step 3"><p>Click the <span class="inlinemediaobject"><img src="../images/DotButton.png"></span> button to open the schema editor where you need to
						create the schema to reflect the structure of the customer data.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization13.png" align="middle"></div></li><li class="step" title="Step 4"><p>Click the <span class="inlinemediaobject"><img src="../images/Button_Plus.png"></span> button five times to add five rows and rename them as
						follows: <span class="emphasis"><em>FirstName</em></span>, <span class="emphasis"><em>LastName</em></span>, <span class="emphasis"><em>City</em></span>, <span class="emphasis"><em>Address</em></span> and
							<span class="emphasis"><em>ZipCode</em></span>.</p><p>In this scenario, we leave the data types with their default value
							<span class="emphasis"><strong>String</strong></span>. In the real-world practice, you
						can change them depending on the data types of your data to be
						processed.</p></li><li class="step" title="Step 5"><p>Click <span class="emphasis"><strong>OK</strong></span> to validate these changes and
						accept the propagation prompted by the pop-up dialog box.</p></li><li class="step" title="Step 6"><p>If needs be, complete the other fields of the <span class="emphasis"><strong>Component</strong></span> view with values corresponding to your data to be
						processed. In this scenario, we leave them as is.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;18.2.&nbsp;Configuring the tPartitioner component"><a name="d0e333812"></a><p class="title"><b>Procedure&nbsp;18.2.&nbsp;Configuring the tPartitioner component</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click <span class="emphasis"><strong>tPartitioner</strong></span> to open its
							<span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization14.png" align="middle"></div></li><li class="step" title="Step 2"><p>In the <span class="emphasis"><strong>Number of Child Threads</strong></span> field, enter the number
						of the threads you want to partition the data flow into. In this example,
						enter <span class="emphasis"><em>3</em></span> because we are using 4 processors
						to run this Job.</p></li><li class="step" title="Step 3"><p>If required, change the value in the <span class="emphasis"><strong>Buffer
							Size</strong></span> field to adapt the memory capacity. In this example, we
						leave the default one.</p></li><li class="step" title="Step 4"><p> Click the <span class="inlinemediaobject"><img src="../images/DotButton.png"></span> button next to <span class="emphasis"><strong>Edit schema</strong></span> to open the schema editor.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization15.png" align="middle"></div></li><li class="step" title="Step 5"><p>Select all the rows in the <span class="emphasis"><strong>tPartitioner</strong></span>
						component schema table using <span class="emphasis"><strong>Ctrl</strong></span> or
							<span class="emphasis"><strong>Shift</strong></span>.</p><p>Then the <span class="inlinemediaobject"><img src="../images/Copy_button.png"></span> on the toolbar is activated.</p></li><li class="step" title="Step 6"><p>Click <span class="inlinemediaobject"><img src="../images/Copy_button.png"></span> to copy the schema selected.</p></li></ol></div></div><div class="section" title="Deduplicating the input records"><div class="titlepage"><div><div><h4 class="title"><a name="d0e333880"></a>Deduplicating the input records</h4></div></div></div><div class="procedure" title="Procedure&nbsp;18.3.&nbsp;Configuring tCollector"><a name="d0e333883"></a><p class="title"><b>Procedure&nbsp;18.3.&nbsp;Configuring tCollector</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click <span class="emphasis"><strong>tCollector</strong></span> to open its
							<span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization5.png" align="middle"></div></li><li class="step" title="Step 2"><p>Click the <span class="inlinemediaobject"><img src="../images/DotButton.png"></span> button next to <span class="emphasis"><strong>Edit
							schema</strong></span> to open the schema editor.</p></li><li class="step" title="Step 3"><p>Press <span class="emphasis"><strong>Ctrl+V</strong></span> to paste the <span class="emphasis"><strong>tPartitioner</strong></span> component schema.</p></li><li class="step" title="Step 4"><p>Click <span class="emphasis"><strong>OK</strong></span> to validate these changes and
						accept the propagation prompted by the pop-up dialog box.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;18.4.&nbsp;Configuring tSortRow"><a name="d0e333923"></a><p class="title"><b>Procedure&nbsp;18.4.&nbsp;Configuring tSortRow</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click <span class="emphasis"><strong>tSortRow</strong></span> to open its
							<span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization16.png" align="middle"></div></li><li class="step" title="Step 2"><p>Under the <span class="emphasis"><strong>Criteria</strong></span> table, click the <span class="inlinemediaobject"><img src="../images/Button_Plus.png"></span> button three times to add three rows to the
						table.</p></li><li class="step" title="Step 3"><p>In the <span class="emphasis"><strong>Schema column</strong></span> column, select, for
						each row, the schema column to be used as the sorting criterion. In this
						example, select <span class="emphasis"><em>ZipCode</em></span>, <span class="emphasis"><em>City</em></span> and <span class="emphasis"><em>Address</em></span>, sequentially.</p></li><li class="step" title="Step 4"><p>In the <span class="emphasis"><strong>Sort num or alpha?</strong></span> column, select
							<span class="emphasis"><strong>alpha</strong></span> for all the three rows.</p></li><li class="step" title="Step 5"><p>In the <span class="emphasis"><strong>Order asc or desc</strong></span> column, select
							<span class="emphasis"><strong>asc</strong></span> for all the three rows.</p></li><li class="step" title="Step 6"><p>If the schema does not appear, click the <span class="emphasis"><strong>Sync
							columns</strong></span> button to retrieve the schema from the preceding
						component. </p></li><li class="step" title="Step 7"><p>Click <span class="emphasis"><strong>Advanced settings</strong></span> to open its
						view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization17.png" align="middle"></div></li><li class="step" title="Step 8"><p>Select <span class="emphasis"><strong>Sort on disk</strong></span>. Then the <span class="emphasis"><strong>Temp data directory path</strong></span> field and the <span class="emphasis"><strong>Create temp data directory if not exist</strong></span> check box
						appear.</p></li><li class="step" title="Step 9"><p>In <span class="emphasis"><strong>Temp data directory path</strong></span>, enter the
						path to, or browse to the folder you want to use to store the temporary data
						processed by <span class="emphasis"><strong>tSortRow</strong></span>. In this approach,
							<span class="emphasis"><strong>tSortRow</strong></span> is enabled to sort
						considerably more data.</p><p>As the threads will overwrite each other if they are written in the same
						directory, you need to create the folder for each thread to be processed
						using its thread ID. To do this, you can drop directly the global variable
							<span class="emphasis"><em>THREAD_ID</em></span> of <span class="emphasis"><strong>tCollector</strong></span> from the <span class="emphasis"><strong>Outline</strong></span>
						view into this field; then the corresponding code is generated
						automatically, reading:
						</p><pre class="programlisting"><code class="code">((Integer)globalMap.get("tCollector_1_THREAD_ID"))</code></pre><p>This
						makes the path read like:</p><p><span class="emphasis"><em>"E:/Studio/workspace/temp"+((Integer)globalMap.get("tCollector_1_THREAD_ID"))</em></span>.</p><p>If the <span class="emphasis"><strong>Outline</strong></span> view does not appear in
						the Studio, you can display it by selecting it from the <span class="emphasis"><strong>[Show view]</strong></span> dialog box. For further information,
						see the user guide of the Studio for integration.</p></li><li class="step" title="Step 10"><p>Ensure that the <span class="emphasis"><strong>Create temp data directory if not
							exists</strong></span> check box is selected.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;18.5.&nbsp;Verifying tDepartitioner"><a name="d0e334053"></a><p class="title"><b>Procedure&nbsp;18.5.&nbsp;Verifying tDepartitioner</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>tDepartitioner</strong></span> component
						open its <span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization18.png" align="middle"></div></li><li class="step" title="Step 2"><p>If required, change the values in the <span class="emphasis"><strong>Buffer
							Size</strong></span> field to adapt the memory capacity. In this example, we
						leave the default value.</p></li><li class="step" title="Step 3"><p>Click the <span class="inlinemediaobject"><img src="../images/DotButton.png"></span> button next to <span class="emphasis"><strong>Edit
							schema</strong></span> to open the schema editor, then, check that all of the
						columns you need to output appear in the schema table of <span class="emphasis"><strong>tDepartitioner</strong></span>. In this scenario, we output all
						the columns received from its preceding components.</p></li></ol></div></div><div class="section" title="Outputting the sorted data"><div class="titlepage"><div><div><h4 class="title"><a name="d0e334087"></a>Outputting the sorted data</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>tRecollector</strong></span> component
						to open its <span class="emphasis"><strong>Component</strong></span> view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization19.png" align="middle"></div></li><li class="step" title="Step 2"><p>Click the <span class="inlinemediaobject"><img src="../images/DotButton.png"></span> button next to <span class="emphasis"><strong>Edit
							schema</strong></span> to open the schema editor, then, paste the <span class="emphasis"><strong>tPartitioner</strong></span> schema we copied earlier when we
						were configuring <span class="emphasis"><strong>tPartitioner</strong></span>.</p><p>This schema should be consistent with that of the <span class="emphasis"><strong>tDepartitioner</strong></span> component offering data to the current
							<span class="emphasis"><strong>tRecollector</strong></span>.</p></li><li class="step" title="Step 3"><p>Click <span class="emphasis"><strong>OK</strong></span> to validate these changes and
						accept the propagation prompted by the pop-up dialog box.</p></li><li class="step" title="Step 4"><p>In the <span class="emphasis"><strong>Linked Departitioner</strong></span> field, select
						the <span class="emphasis"><strong>tDepartitioner</strong></span> component you want this
						component to receive data from. In this example, it is the <span class="emphasis"><strong>tDepartitioner</strong></span> component labelled <span class="emphasis"><em>tDepartitioner_1</em></span>. Therefore, select <span class="emphasis"><em>tDepartitioner_1</em></span>.</p></li><li class="step" title="Step 5"><p>Double click the <span class="emphasis"><strong>tFileOutputDelimited</strong></span>
						component to open its <span class="emphasis"><strong>Component</strong></span>
						view.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization20.png" align="middle"></div></li><li class="step" title="Step 6"><p>In the <span class="emphasis"><strong>File Name</strong></span> field, browse to the
						file, or enter the directory and the name of the file, that you want to
						write the sorted data in. At runtime, this file will be created if it does
						not exist.</p></li></ol></div></div><div class="section" title="Executing the Job"><div class="titlepage"><div><div><h4 class="title"><a name="d0e334169"></a>Executing the Job </h4></div></div></div><p>Then you can press <span class="emphasis"><strong>F6</strong></span> to run this Job.</p><p>Once done, you can check the file holding the sorted data and the temporary
				folders created by <span class="emphasis"><strong>tSortRow</strong></span> for sorting data on
				disk. These folders were emptied once the sorting had been done.</p><div class="mediaobject" align="center"><img src="../images/use_case-parallelization21.png" align="middle"></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="tParallelize.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch-orchestration.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="tPostjob.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">tParallelize&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="bk-tdi-components-rg-en..html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;tPostjob</td></tr></table></div></body></html>