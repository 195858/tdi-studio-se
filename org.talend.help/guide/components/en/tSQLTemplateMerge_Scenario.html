<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN" "http://www.w3.org/MarkUp/Wilbur/HTML32.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="GENERATOR" content="Quadralay WebWorks Publisher Standard Edition 8.0.5337.0">
    <meta name="TEMPLATEBASE" content="Dynamic HTML">
    <meta name="LASTUPDATED" content="04/28/11 19:32:33">
    <title>Scenario: Merging data directly on the DBMS</title>
  </head>

  <body link="#3366CC" vlink="#9999CC" text="#000000" alink="#0000CC" bgcolor="#FFFFFF">

    <!--table width="220" border="0" align="right" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
<a accesskey="4" href="tSQLTemplateMerge_Prop.html"><img id="LongDescNotReq1" src="images/prev.gif" border="0" alt="Previous" /></a><a accesskey="5" href="tSQLTemplateRollback_Prop.html"><img id="LongDescNotReq2" src="images/next.gif" border="0" alt="Next" /></a>
        </td>
      </tr>
    </table-->

    <!--img src="images/wwplogo.gif" width="122" height="63" alt="Put your logo here!">
    <hr align="left"-->

    <blockquote>
<a name="wp3985350"> </a><div style="color: #000000; font-size: 12pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<a name="wp3985357"> </a><h2 class="pHeading2">
Scenario: Merging data directly on the DBMS
</h2>
<a name="wp3985360"> </a><p class="pIndented1">
This scenario describes a simple Job that opens a connection to a MySQL database, merges data from a source table into a target table according to customer IDs, and displays the contents of the target table before and after the merge action. A WHERE clause is used to filter data during the merge operation.
</p>
<a name="wp3985368"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge1.png" id="wp3985365" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985376"> </a><div class="pSmartList2"><li>Drop a <b class="cBold">tMysqlConnection</b> component, a <b class="cBold">tSQLTemplateMerge</b> component, two <b class="cBold">tMysqlInput</b> components and two <b class="cBold">tLogRow</b> components from the <b class="cBold">Palette</b> onto the design workspace. </li></div>
<a name="wp3985395"> </a><div class="pSmartList2"><li>Connect the <b class="cBold">tMysqlConnection</b> component to the first <b class="cBold">tMysqlInput</b> component using a <b class="cBold">Trigger</b> &gt; <b class="cBold">OnSubjobOK</b> connection.</li></div>
<a name="wp3985414"> </a><div class="pSmartList2"><li>Connect the first <b class="cBold">tMysqlInput</b> component to the first <b class="cBold">tLogRow</b> component using a <b class="cBold">Row</b> &gt; <b class="cBold">Main</b> connection. This row will display the initial contents of the target table on the console.</li></div>
<a name="wp3985427"> </a><div class="pSmartList2"><li>Connect the first <b class="cBold">tMysqlInput</b> component to the <b class="cBold">tSQLTemplateMerge</b> component, and the <b class="cBold">tSQLTemplateMerge</b> component to the second <b class="cBold">tMysqlInput</b> component using <b class="cBold">Trigger</b> &gt; <b class="cBold">OnSubjobOK</b> connections.</li></div>
<a name="wp3985446"> </a><div class="pSmartList2"><li>Connect the second <b class="cBold">tMysqlInput</b> component to the second <b class="cBold">tLogRow</b> component using a <b class="cBold">Row</b> &gt; <b class="cBold">Main</b> connection. This row will display the merge result on the console.</li></div>
<a name="wp3986988"> </a><div class="pSmartList2"><li>Double-click the <b class="cBold">tMysqlConnection</b> component to display its <b class="cBold">Basic settings</b> view.</li></div>
</ul></div>
</ul></div>
<a name="wp3985471"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge2.png" id="wp3985468" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985482"> </a><div class="pSmartList2"><li>Set the database connection details manually or select <b class="cBold">Repository</b> from the <b class="cBold">Property Type</b> list and select your DB connection if it has already been defined and stored in the <b class="cBold">Metadata</b> area of the <b class="cBold">Repository</b> tree view.<br />For more information about Metadata, see <em class="cEmphasis">How to centralize the Metadata items</em> of <b class="cBold">Talend Integration Suite Studio</b> User Guide. </li></div>
<a name="wp3985503"> </a><div class="pSmartList2"><li>Double-click the first <b class="cBold">tMysqlInput</b> component to display its <b class="cBold">Basic settings</b> view.</li></div>
</ul></div>
</ul></div>
<a name="wp3985510"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge3.png" id="wp3985507" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985518"> </a><div class="pSmartList2"><li>Select the <b class="cBold">Use an existing connection</b> check box. If you are using more than one DB connection component in your Job, select the component you want to use from the <b class="cBold">Component List</b>.</li></div>
<a name="wp3985528"> </a><div class="pSmartList2"><li>Click the three-dot button next to <b class="cBold">Edit schema</b> and define the data structure of the target table, or select <b class="cBold">Repository</b> from the <b class="cBold">Schema</b> list and select the target table if the schema has already been defined and stored in the <b class="cBold">Metadata</b> area of the <b class="cBold">Repository</b> tree view.<br />In this scenario, we use built-in schemas.</li></div>
</ul></div>
</ul></div>
<a name="wp3985549"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge4.png" id="wp3985546" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985557"> </a><div class="pSmartList2"><li>Define the columns as shown above, and then click <b class="cBold">OK</b> to propagate the schema structure to the output component and close the schema dialog box.</li></div>
<a name="wp3985570"> </a><div class="pSmartList2"><li>Fill the <b class="cBold">Table Name</b> field with the name of the target table, <em class="cEmphasis">customer_info_merge</em> in this scenario.</li></div>
<a name="wp3985577"> </a><div class="pSmartList2"><li>Click the <b class="cBold">Guess Query</b> button, or type in <code class="cCode">&quot;SELECT * FROM customer_info_merge&quot;</code> in the <b class="cBold">Query</b> area, to retrieve all the table columns.</li></div>
<a name="wp3985584"> </a><div class="pSmartList2"><li>Define the properties of the second <b class="cBold">tMysqlInput</b> component, using exactly the same settings as for the first <b class="cBold">tMysqlInput</b> component.</li></div>
<a name="wp3985600"> </a><div class="pSmartList2"><li>In the <b class="cBold">Basic settings</b> view of each <b class="cBold">tLogRow</b> component, select the <b class="cBold">Table</b> option in the <b class="cBold">Mode</b> area so that the contents will be displayed in table cells on the console.</li></div>
</ul></div>
</ul></div>
<a name="wp3985609"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge5.png" id="wp3985606" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985622"> </a><div class="pSmartList2"><li>Double-click the <b class="cBold">tSQLTemplateMerge</b> component to display its <b class="cBold">Basic settings</b> view.</li></div>
</ul></div>
</ul></div>
<a name="wp3985629"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge6.png" id="wp3985626" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985634"> </a><div class="pSmartList2"><li>Type in the names of the source table and the target table in the relevant fields. <br />In this scenario, the source table is <em class="cEmphasis">new_customer_info</em>, which contains eight records; the target table is <em class="cEmphasis">customer_info_merge</em>, which contains five records, and both tables have the same data structure.</li></div>
<a name="wp3989272"> </a><p class="pBodyRelative">
<br />
<img src="../Images/bulb_smalljj.png" align="left" id="wp3989261" border="0" hspace="0" vspace="0"/><br />
The source table and the target table may have different schema structures. In this case, however, make sure that the source column and target column specified in each line of the <b class="cBold">Merge ON</b> table, the <b class="cBold">UPDATE Columns</b> table, and the <b class="cBold">INSERT Columns</b> table are identical in data type and the target column length allows the insertion of the data from the corresponding source column.
</p>
<a name="wp3989280"> </a><div class="pSmartList2"><li>Define the source schema manually, or select <b class="cBold">Repository</b> from the <b class="cBold">Schema</b> list and select the relevant table if the schema has already been defined and stored in the <b class="cBold">Metadata</b> area of the <b class="cBold">Repository</b> tree view.<br />In this scenario, we use built-in schemas.</li></div>
</ul></div>
</ul></div>
<a name="wp3988968"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge7.png" id="wp3985662" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985676"> </a><div class="pSmartList2"><li>Define the columns as shown above and click <b class="cBold">OK</b> to close the schema dialog box, and do the same for the target schema.</li></div>
<a name="wp3985686"> </a><div class="pSmartList2"><li>Click the green plus button beneath the <b class="cBold">Merge ON</b> table to add a line, and select the <em class="cEmphasis">ID</em> column as the primary key. </li></div>
</ul></div>
</ul></div>
<a name="wp3985695"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge8.png" id="wp3985692" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985703"> </a><div class="pSmartList2"><li>Select the <b class="cBold">Use UPDATE</b> check box to update existing data during the merge operation, and define the columns to be updated by clicking the green plus button and selecting the desired columns. <br />In this scenario, we want to update all the columns according to the customer IDs. Therefore, we select all the columns except the <em class="cEmphasis">ID</em> column.</li></div>
<a name="wp3985714"> </a><p class="pBodyRelative">
<br />
<img src="../Images/warning_smalljl.png" align="left" id="wp3985712" border="0" hspace="0" vspace="0"/><br />
<br />The columns defined as the primary key CANNOT and MUST NOT be made subject to updates.
</p>
<a name="wp3985723"> </a><div class="pSmartList2"><li>Select the <b class="cBold">Specify UPDATE WHERE clause</b> check box and type in <code class="cCode">customer_info_merge.ID &gt;= 4</code> within double quotation marks in the <b class="cBold">WHERE clause</b> field so that only those existing records with an ID equal to or greater than 4 will be updated.</li></div>
</ul></div>
</ul></div>
<a name="wp3985738"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge8.png" id="wp3985735" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985746"> </a><div class="pSmartList2"><li>Select the <b class="cBold">Use INSERT</b> check box and define the columns to take data from and insert data to in the <b class="cBold">INSERT Columns</b> table.<br />In this example, we want to insert all the records that do not exist in the target table.</li></div>
</ul></div>
</ul></div>
<a name="wp3985758"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge8.png" id="wp3985755" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3985767"> </a><div class="pSmartList2"><li>Select the <b class="cBold">SQL Template</b> view to display and add the SQL templates to be used.<br />By default, the <b class="cBold">SQLTemplateMerge</b> component uses two system SQL templates: <b class="cBold">MergeUpdate</b> and <b class="cBold">MergeInsert</b>. </li></div>
<a name="wp3986180"> </a><p class="pBodyRelative">
<br />
<img src="../Images/bulb_smalljj.png" align="left" id="wp3986169" border="0" hspace="0" vspace="0"/><br />
In the <b class="cBold">SQL Template</b> tab, you can add system SQL templates or create your own and use them within your Job to carry out the coded operation. For more information, see <a href="tSQLTemplateFilterColumns_Prop.html#wp3963839"><em class="cEmphasis">tSQLTemplateFilterColumns Properties</em></a>.
</p>
</ul></div>
</ul></div>
<a name="wp3986188"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge9.png" id="wp3985941" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
<div class="pSmartList1"><ul class="pSmartList1">
<div class="pSmartList2"><ul class="pSmartList2">
<a name="wp3986231"> </a><div class="pSmartList2"><li>Click the <b class="cBold">Add</b> button to add a line and select <b class="cBold">Commit</b> from the template list to commit the merge result to your database.<br />Alternatively, you can connect the <b class="cBold">tSQLTemplateMerge</b> component to a <b class="cBold">tSQLTemplateCommit</b> or <b class="cBold">tMysqlCommit</b> component using a <b class="cBold">Trigger</b> &gt; <b class="cBold">OnSubjobOK</b> connection to commit the merge result to your database.</li></div>
<a name="wp3986291"> </a><div class="pSmartList2"><li>Save your Job and press <b class="cBold">F6</b> to run it.<br />Both the original contents of the target table and the merge result are displayed on the console. In the target table, records No. 4 and No. 5 contain the updated information, and records No.6 through No. 8 contain the inserted information. </li></div>
</ul></div>
</ul></div>
<a name="wp3986356"> </a><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">
</div>
<div align="center"><img src="../Images/Use_Case_tSQLTemplateMerge10.png" id="wp3986353" border="0" hspace="0" vspace="0"/></div><div style="color: #000000; font-size: 2pt; font-style: normal; font-variant: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none">

</div>
    </blockquote>
    <hr>

    <!--table align="right" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td align="right"><font size="1">
          <a href="http://www.webworks.com"><img src="images/webworks.gif" width="150" height="20" border="0"></a><br>
            Quadralay Corporation<br>
            http://www.webworks.com<br>
            Voice: (512) 719-3399<br>
            Fax: (512) 719-3606<br>
          <a href="mailto:sales@webworks.com">sales@webworks.com</a><br>
        </font></td>
      </tr>
    </table-->

    <!--table width="220" border="0" cellpadding="0" cellspacing="0">
      <tr> 
        <td>
<a accesskey="4" href="tSQLTemplateMerge_Prop.html"><img id="LongDescNotReq3" src="images/prev.gif" border="0" alt="Previous" /></a><a accesskey="5" href="tSQLTemplateRollback_Prop.html"><img id="LongDescNotReq4" src="images/next.gif" border="0" alt="Next" /></a>
        </td>
      </tr>
    </table-->
  </body>
</html>
