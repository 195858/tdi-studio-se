<%@ jet 
	imports="
        java.util.List
        org.talend.core.model.process.ElementParameterParser
        org.talend.core.model.process.IConnection
        org.talend.core.model.process.IConnectionCategory
        org.talend.core.model.process.INode
        org.talend.designer.codegen.config.CodeGeneratorArgument
	" 
%>
<% 
CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
INode node = (INode)codeGenArgument.getArgument();
String cid = node.getUniqueName();
String fileFormat = ElementParameterParser.getValue(node,"__FILE_FORMAT__");
String filename = ElementParameterParser.getValue(node,"__FILENAME__");
String outConnName = null;
String encoding = ElementParameterParser.getValue(node,"__ENCODING__");
List< ? extends IConnection> outConns = node.getOutgoingConnections();
for(IConnection conn : outConns){
	if (conn.getLineStyle().hasConnectionCategory(IConnectionCategory.DATA)) {
		outConnName = conn.getName();
	}
}
if(outConnName == null){
    return ""; //return immediately, generate nothing
}
%>
	java.io.File file_<%=cid%> = new java.io.File(<%=filename%>);
<%
if(("PROPERTIES_FORMAT").equals(fileFormat)){
%>
	java.util.Properties properties_<%=cid%> = new java.util.Properties();
	properties_<%=cid%>.load(new java.io.FileInputStream(file_<%=cid%>));
	
	java.util.Enumeration enumeration_<%=cid%> = properties_<%=cid%>.propertyNames();
	while (enumeration_<%=cid%>.hasMoreElements()) {
		<%=outConnName %>.key = (String)enumeration_<%=cid%>.nextElement();
		<%=outConnName %>.value = (String)properties_<%=cid%>.getProperty(<%=outConnName %>.key);
<%
}else if(("INI_FORMAT").equals(fileFormat)){
	String sectionName = ElementParameterParser.getValue(node,"__SECTION_NAME__");
%>
    org.ini4j.Wini ini_<%=cid%> = new org.ini4j.Wini(new java.io.File(<%=filename%>));
    ini_<%=cid%>.getConfig().setFileEncoding(java.nio.charset.Charset.forName(<%=encoding %>));
    org.ini4j.Profile.Section section_<%=cid%> = ini_<%=cid%>.get(<%=sectionName%>);
    java.util.Set<String> names_<%=cid%> = section_<%=cid%>.keySet();
    java.util.Iterator<String> it_<%=cid%> = names_<%=cid%>.iterator();
	while (it_<%=cid%>.hasNext()) {
	    String key_<%=cid%> = it_<%=cid%>.next();
		<%=outConnName %>.key = key_<%=cid%>;
		<%=outConnName %>.value = section_<%=cid%>.get(key_<%=cid%>);
<%
}
%>
