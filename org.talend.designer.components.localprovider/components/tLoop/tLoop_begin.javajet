<%@ jet 
imports="
    org.talend.core.model.process.INode 
    org.talend.core.model.process.ElementParameterParser
    org.talend.designer.codegen.config.CodeGeneratorArgument
" 
%>

<%
CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
INode node = (INode)codeGenArgument.getArgument();
String cid = node.getUniqueName();

boolean forLoop = ElementParameterParser.getValue(
    node,
    "__FORLOOP__"
).equals("true");

boolean whileLoop = ElementParameterParser.getValue(
    node,
    "__WHILELOOP__"
).equals("true");

%>
int current_iteration_<%=cid%> = 0;
<%
if (forLoop) {

String from = ElementParameterParser.getValue(node, "__FROM__");
if (from.equals("")) from = "1";
String to   = ElementParameterParser.getValue(node, "__TO__");
if (to.equals("")) to = "1";
String step   = ElementParameterParser.getValue(node, "__STEP__");
if (step.equals("")) step = "1";
%>

for(int loop<%=cid%> =<%=from%>; loop<%=cid%><<%=to%>; loop<%=cid%>=loop<%=cid%>+<%=step%>){

current_iteration_<%=cid%>++;
globalMap.put("<%=cid%>_CURRENT_ITERATION",current_iteration_<%=cid%>);

<%
}else{// While type

String condition = ElementParameterParser.getValue(node, "__CONDITION__");
condition = condition.substring(1,condition.length()-1);
String declaration = ElementParameterParser.getValue(node, "__DECLARATION__");
declaration = declaration.substring(1,declaration.length()-1);

%>

<%=declaration%>;

while(<%=condition%>){

current_iteration_<%=cid%>++;
globalMap.put("<%=cid%>_CURRENT_ITERATION",current_iteration_<%=cid%>);

<%
}
%>
