<%@ jet 
	imports="
		org.talend.core.model.process.INode
		org.talend.designer.codegen.config.CodeGeneratorArgument
		org.talend.core.model.process.ElementParameterParser
		java.util.List
		java.util.Map"
%>
<%
CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
INode node = (INode)codeGenArgument.getArgument();
String cid = node.getUniqueName();
String fileName = ElementParameterParser.getValue(node, "__FILENAME__");
String dirName = ElementParameterParser.getValue(node, "__DIRECTORY__");
String path = ElementParameterParser.getValue(node, "__PATH__");
String failon = ElementParameterParser.getValue(node, "__FAILON__");
boolean ifFolder = ("true").equals(ElementParameterParser.getValue(node, "__FOLDER__"));
boolean either = ("true").equals(ElementParameterParser.getValue(node, "__FOLDER_FILE__"));
%>
class DeleteFolder<%=cid%>{
	 /**
     * delete all the sub-files in 'file'
     * 
     * @param file
     */
	public void delete(java.io.File file) {
        // TODO Auto-generated method stub
        java.io.File[] files = file.listFiles();
        for (int i = 0; i < files.length; i++) {
            if (files[i].isFile()) {
                files[i].delete();
            } else if (files[i].isDirectory()) {
                if (!files[i].delete()) {
                    delete(files[i]);
                }
            }
        }
        deleteDirectory(file);
        file.delete();
    }

    /**
     * delete all the sub-folders in 'file'
     * 
     * @param file
     */
    private void deleteDirectory(java.io.File file) {
        // TODO Auto-generated method stub
        java.io.File[] filed = file.listFiles();
        for (int i = 0; i < filed.length; i++) {
            deleteDirectory(filed[i]);
            filed[i].delete();
        }
    }

}
<%
if(either){%>

	java.io.File path_<%=cid%>=new java.io.File(<%=path%>);
	if(path_<%=cid%>.exists()){
	  if(path_<%=cid%>.isFile()){
		path_<%=cid%>.delete();
	  }else if(path_<%=cid%>.isDirectory()){ 
	    DeleteFolder<%=cid%> df<%=cid%> = new DeleteFolder<%=cid%>();
	    df<%=cid%>.delete(path_<%=cid%>);   
	  }
    }
<%
	if(("true").equals(failon)){
%>
    else{
    	throw new RuntimeException("the file or path does not exists or is invalid");
    }
<%
	}
%>
    globalMap.put("<%=cid %>_DELETE_PATH",<%=path%>);
<%
}else if(ifFolder){
%>

java.io.File file<%=cid%> = new java.io.File(<%=dirName%>);

if(file<%=cid%>.exists()&& file<%=cid%>.isDirectory()){
	DeleteFolder<%=cid%> df<%=cid%> = new DeleteFolder<%=cid%>();
	df<%=cid%>.delete(file<%=cid%>);
}
<%
	if(("true").equals(failon)){
%>
    else{
    	throw new RuntimeException("Directory does not exists or is invalid");
    }
<%
	}
	%>
	globalMap.put("<%=cid %>_DELETE_PATH",<%=dirName%>);
<%
}else{
%>
    java.io.File file_<%=cid%>=new java.io.File(<%=fileName%>);
    if(file_<%=cid%>.exists()&& file_<%=cid%>.isFile())
    {
    	file_<%=cid%>.delete();
    }
<%
	if(("true").equals(failon)){
%>
    else{
    	throw new RuntimeException("File does not exists or is invalid");
    }
<%
	}
	%>
	globalMap.put("<%=cid %>_DELETE_PATH",<%=fileName%>);
	<%
}
%>
    
     
 
