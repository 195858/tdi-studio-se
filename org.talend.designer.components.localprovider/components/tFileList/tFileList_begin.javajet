<%@ jet 
	package="org.talend.designer.codegen.translators" 
	imports="
		org.talend.core.model.process.INode 
		org.talend.core.model.process.ElementParameterParser 
		org.talend.core.model.metadata.IMetadataTable 
		org.talend.core.model.metadata.IMetadataColumn 
		org.talend.designer.codegen.config.CodeGeneratorArgument
		java.util.List
	" 
	class="FileListBegin" 
%>

<%
	CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
	INode node = (INode)codeGenArgument.getArgument();
	String cid = node.getUniqueName();
	boolean stats = codeGenArgument.isStatistics();
	
	List<IMetadataTable> metadatas = node.getMetadataList();
	if ((metadatas!=null)&&(metadatas.size()>0)) {
		IMetadataTable metadata = metadatas.get(0);
		if (metadata!=null) {
%>

        String directory<%=cid %>       = <%=ElementParameterParser.getValue(node, "__DIRECTORY__") %>;
        String filemask<%=cid %>        = <%=ElementParameterParser.getValue(node, "__FILEMASK__")%>;
        filemask<%=cid %> = java.util.regex.Pattern.compile("[*]").matcher(filemask<%=cid %>).replaceAll(".*");
        boolean case_sensitive<%=cid %> = <%=ElementParameterParser.getValue(node, "__CASE_SENSITIVE__").equals("YES") %>;
		if(!case_sensitive<%=cid %>){
        	java.util.regex.Pattern fileNamePattern<%=cid %> = java.util.regex.Pattern.compile(filemask<%=cid %>, java.util.regex.Pattern.CASE_INSENSITIVE);
		}        
		java.util.regex.Pattern fileNamePattern<%=cid %> = java.util.regex.Pattern.compile(filemask<%=cid %>);
 		java.io.File file<%=cid %>=new java.io.File(directory<%=cid %>);
        java.io.File[] files<%=cid %> = file<%=cid %>.listFiles();
        for (int i<%=cid%> = 0; i<%=cid%> < files<%=cid %>.length; i<%=cid%>++){
			if(!fileNamePattern<%=cid %>.matcher(files<%=cid %>[i<%=cid%>].getName()).find()){
				continue;
			}               
			String <%=metadata.getTableName() %>_CurrentFileName = files<%=cid %>[i<%=cid%>].getName(); 
            String <%=metadata.getTableName() %>_CurrentFilePath = files<%=cid %>[i<%=cid%>].getAbsolutePath();
<%
		}
	}
%>
