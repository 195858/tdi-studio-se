<%@ jet 
imports="
			org.talend.core.model.process.INode 
			org.talend.core.model.process.ElementParameterParser 
			org.talend.designer.codegen.config.CodeGeneratorArgument
		" 
%>

<%
	CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
	
	INode node = (INode)codeGenArgument.getArgument();
	
	String cid = node.getUniqueName();
	
	String host =  ElementParameterParser.getValue(node, "__HOST__");
	
	String dbname= ElementParameterParser.getValue(node, "__DBNAME__");
	
	String username = ElementParameterParser.getValue(node, "__USER__");
	
	String password = ElementParameterParser.getValue(node, "__PASS__");
			
	String dbencoding= ElementParameterParser.getValue(node, "__ENCODING__");
	
    String commitEvery = ElementParameterParser.getValue(node, "__COMMIT_EVERY__");
    
    String javaDbDriver   = "interbase.interclient.Driver";  
    
    String useExistingConn = ElementParameterParser.getValue(node,"__USE_EXISTING_CONNECTION__");
    
    if(useExistingConn.equals("true")) {
    	String connection = ElementParameterParser.getValue(node,"__CONNECTION__");
        String conn = "conn_" + connection;
        %>
        java.sql.Connection conn_<%=cid%> = (java.sql.Connection)globalMap.get("<%=conn%>");
        <%
    } else {
        %>
        java.lang.Class.forName("<%=javaDbDriver %>");        
        String url_<%=cid %> = "jdbc:interbase://" + <%=host%> + "/" + <%=dbname%>;        
        String userName_<%=cid%> = <%=username%>;        
        String password_<%=cid%> = <%=password%>;        
        java.sql.Connection conn_<%=cid%> = java.sql.DriverManager.getConnection(url_<%=cid %>,userName_<%=cid%>,password_<%=cid%>);
        <%
    }
    %>

    <%
    if(!useExistingConn.equals("true")) {
        if(!commitEvery.equals("") && !commitEvery.equals("0")) {
            %>
            conn_<%=cid%>.setAutoCommit(false);            
            int commitEvery_<%=cid%> = <%=commitEvery%>;            
            int commitCounter_<%=cid%> = 0;    
            <%
        }
    }
    %>
    java.sql.Statement stmt_<%=cid %> = conn_<%=cid %>.createStatement();    
    String query_<%=cid %> = "";
    boolean whetherReject_<%=cid%> = false;   
