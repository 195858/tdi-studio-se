<%@ jet 
imports="
    org.talend.core.model.process.INode 
    org.talend.core.model.process.ElementParameterParser 
    org.talend.core.model.metadata.IMetadataTable 
    org.talend.core.model.metadata.IMetadataColumn 
    org.talend.core.model.process.IConnection
    org.talend.designer.codegen.config.CodeGeneratorArgument
    org.talend.core.model.process.IConnectionCategory
    org.talend.core.model.metadata.types.JavaTypesManager
    org.talend.core.model.metadata.types.JavaType
    java.util.Map    
    java.util.List
" 
class="MomInput"
%>

<%
	CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
	INode node = (INode)codeGenArgument.getArgument();
	String cid = node.getUniqueName();
	String serverType=ElementParameterParser.getValue(node, "__SERVER__");
	String useMsgId=ElementParameterParser.getValue(node, "__IS_USE_MESSAGE_ID__");
	
	String isMapMessage= ElementParameterParser.getValue(node, "__IS_MAPMESSAGE__");
	
	
	List<IMetadataTable> metadatas = node.getMetadataList();
	if ((metadatas!=null)&&(metadatas.size()>0)) {
		IMetadataTable metadata = metadatas.get(0);
		List<IMetadataColumn> columns = metadata.getListColumns();
		List< ? extends IConnection> conns = node.getIncomingConnections();
		if((conns!=null)&&(conns.size()>0)) {
			IConnection conn = conns.get(0);
			if (conn.getLineStyle().hasConnectionCategory(IConnectionCategory.DATA)){
%>
	String msg_<%=cid%> = <%=conn.getName() %>.<%=((IMetadataColumn)columns.get(0)).getLabel() %>;
<%
				if(useMsgId.equals("true")){
%>
	String msgID_<%=cid%> = <%=conn.getName() %>.<%=((IMetadataColumn)columns.get(1)).getLabel() %>;
<%
				}
if(serverType.equals("JBoss")){ // server judgement
					String msgType = ElementParameterParser.getValue(node, "__MSGTYPE__");
					if(useMsgId.equals("true")){
%>
	javax.jms.MapMessage messageQ_<%=cid%> = session_<%=cid%>.createMapMessage();
    messageQ_<%=cid%>.setString(msgID_<%=cid%>,msg_<%=cid%>);
<%
					}else{
%>					
    javax.jms.TextMessage messageQ_<%=cid%> = session_<%=cid%>.createTextMessage();
    messageQ_<%=cid%>.setText(msg_<%=cid%>);
<%
					}
                    if(msgType.equals("Queue")){
%>
    javax.jms.QueueSender queueSender_<%=cid%>=session_<%=cid%>.createSender(type_<%=cid%>);
    queueSender_<%=cid%>.send(type_<%=cid%>,messageQ_<%=cid%>);
<%
                    }else{
%>
	javax.jms.TopicPublisher topicPublisher_<%=cid%>=session_<%=cid%>.createPublisher(type_<%=cid%>);
	topicPublisher_<%=cid%>.publish(type_<%=cid%>,messageQ_<%=cid%>);
<%
					}
				}
				
else if(serverType.equals("ActiveMQ")){ // ***************ActiveMQ*************** 
		if("true".equals(isMapMessage)){
%>
		javax.jms.MapMessage message_<%=cid%> = session_<%=cid%>.createMapMessage();
	    <%
		for (IMetadataColumn column: metadata.getListColumns()) {
			String type = JavaTypesManager.getTypeToGenerate(column.getTalendType(), true);
			JavaType javaType = JavaTypesManager.getJavaTypeFromId(column.getTalendType());
		%>

				<%if (javaType == JavaTypesManager.BOOLEAN || 
								javaType == JavaTypesManager.BYTE || 
								javaType == JavaTypesManager.DOUBLE || 
								javaType == JavaTypesManager.FLOAT || 
								javaType == JavaTypesManager.LONG || 
								javaType == JavaTypesManager.SHORT || 
								javaType == JavaTypesManager.STRING) {
					%>
					((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).set<%=type%>("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
				<%
					}else if (javaType == JavaTypesManager.BYTE_ARRAY) {
				%>
						((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).setBytes("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
				<%			
					}else if (javaType == JavaTypesManager.CHARACTER) {
				%>
							((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).setChar("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
				<%
					}else if (javaType == JavaTypesManager.DATE) {
				%>
							((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).setObject("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
				<%
					}else if (javaType==JavaTypesManager.INTEGER) {
				%>
							((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).setInt("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
				<%
					}else {
				%>
							((org.apache.activemq.command.ActiveMQMapMessage)message_<%=cid%>).setObject("<%=column.getLabel()%>" ,<%=conn.getName()%>.<%=column.getLabel()%>) ;
				<%}%>	    
			 <%
			} // end of for
			%>
				producer_<%=cid%>.send(message_<%=cid%>);
				message_<%=cid%>.clearBody();
			
<% } else { // 
%>
		javax.jms.TextMessage message_<%=cid%> = session_<%=cid%>.createTextMessage(<%=conn.getName()%>.message);		
		producer_<%=cid %>.send(message_<%=cid %>);
<%		
	} // END OF MAP Message

}	

else{//server judgement   /***WebSphere MQ*****/
%>
	com.ibm.jms.JMSMessage message_<%=cid%> = null;
	
<% 	if ("true".equals(isMapMessage)) {
%>	
 	message_<%=cid%> = (com.ibm.jms.JMSMapMessage) session_<%=cid%>.createMapMessage();  
	<%
	for (IMetadataColumn column: metadata.getListColumns()) {
		String type = JavaTypesManager.getTypeToGenerate(column.getTalendType(), true);
		JavaType javaType = JavaTypesManager.getJavaTypeFromId(column.getTalendType());
%>		
		 
		<%if (javaType == JavaTypesManager.BOOLEAN || 
					javaType == JavaTypesManager.BYTE || 
					javaType == JavaTypesManager.DOUBLE || 
					javaType == JavaTypesManager.FLOAT || 
					javaType == JavaTypesManager.LONG || 
					javaType == JavaTypesManager.SHORT || 
					javaType == JavaTypesManager.STRING) {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).set<%=type%>("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
		<%
		}else if (javaType == JavaTypesManager.BYTE_ARRAY) {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).setBytes("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
		<%			
		} else if (javaType == JavaTypesManager.CHARACTER) {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).setChar("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
		<%
		} else if (javaType == JavaTypesManager.DATE) {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).setObject("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
		<%
		} else if (javaType==JavaTypesManager.INTEGER) {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).setInt("<%=column.getLabel()%>" ,<%=conn.getName() %>.<%=column.getLabel()%>) ;
		<%
		} else {
		%>
				((com.ibm.jms.JMSMapMessage)message_<%=cid%>).setObject("<%=column.getLabel()%>" ,<%=conn.getName()%>.<%=column.getLabel()%>) ;
		<%
		}%>	
		
		
<%
	} // end of for
%>
		producer_<%=cid%>.send(message_<%=cid%>);
		message_<%=cid%>.clearBody();
			
<%} else { // text Message
%>
		
		message_<%=cid%> = (com.ibm.jms.JMSTextMessage) session_<%=cid%>.createTextMessage(); 
		((com.ibm.jms.JMSTextMessage)message_<%=cid%>).setText(<%=conn.getName()%>.message);
		producer_<%=cid%>.send(message_<%=cid%>) ;
		message_<%=cid%>.clearBody();
		
<%		
}
%>



<%
				}
			}
		}
	}  
%>
	


		