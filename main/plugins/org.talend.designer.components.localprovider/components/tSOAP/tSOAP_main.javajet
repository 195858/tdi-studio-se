<%@ jet 
imports="
    	org.talend.core.model.process.INode 
    	org.talend.core.model.process.ElementParameterParser 
		org.talend.designer.codegen.config.CodeGeneratorArgument
		org.talend.core.model.process.IConnection
		org.talend.core.model.process.IConnectionCategory
        java.util.Map
        java.util.List
" 
%>

<%
CodeGeneratorArgument codeGenArgument = (CodeGeneratorArgument) argument;
INode node = (INode)codeGenArgument.getArgument();
String cid = node.getUniqueName();

String endpoint = ElementParameterParser.getValue(node,"__ENDPOINT__");
String action = ElementParameterParser.getValue(node,"__ACTION__");
String soapMessageStr = ElementParameterParser.getValue(node,"__SOAPMESSAGE__");
soapMessageStr = soapMessageStr.replaceAll("[\r\n]", " ");
        
String soapVersion = ElementParameterParser.getValue(node,"__SOAP_VERSION__");
%>
<%if("Soap12".equals(soapVersion)){%>
String soapVersion_<%=cid%> = org.talend.soap.SOAPUtil.SOAP12;
<%}else{%>
String soapVersion_<%=cid%> = org.talend.soap.SOAPUtil.SOAP11;
<%}%>
		
soapUtil_<%=cid%>.invokeSOAP(soapVersion_<%=cid%>,<%=endpoint%>,<%=action%>,<%=soapMessageStr%>);
		// for output
<%
	List< ? extends IConnection> conns = node.getOutgoingSortedConnections();
	if (conns!=null) {//1
		if (conns.size()>0) {//2
			IConnection conn = conns.get(0); //the first connection
			if (conn.getLineStyle().hasConnectionCategory(IConnectionCategory.DATA)) {//3
%>		
				<%=conn.getName() %> = new <%=conn.getName() %>Struct();
				<%=conn.getName() %>.Header = soapUtil_<%=cid%>.getReHeaderMessage();
				if(soapUtil_<%=cid%>.hasFault()){
					<%=conn.getName() %>.Fault = soapUtil_<%=cid%>.getReFaultMessage();
				}else{
					<%=conn.getName() %>.Body = soapUtil_<%=cid%>.getReBodyMessage();
				}
<%			
			}//3
		}//2
	}//1
%>
        

